<div class="container" style="padding:2rem; max-width:1200px; margin:auto;">

  <p-card header="סל הקניות שלי">

    <ng-container *ngIf="groupedItems$ | async as items">

      <div *ngIf="items.length > 0; else emptyCart">

        <p-table [value]="items" responsiveLayout="scroll">

          <ng-template pTemplate="header">
            <tr>
              <th>מתנה</th>
              <th>מחיר</th>
              <th class="text-center">כמות</th>
              <th>סה"כ</th>
              <th></th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-item>
            <tr>

              <td>{{ item.name }}</td>

              <td>
                {{ item.price | currency:'ILS':'symbol':'1.0-0' }}
              </td>

              <td class="text-center">
                <div class="flex gap-2 justify-content-center">

                  <button pButton icon="pi pi-minus"
                          class="p-button-rounded p-button-outlined p-button-sm"
                          (click)="decreaseQuantity(item)"
                          [disabled]="isLoading">
                  </button>

                  <span class="font-bold">{{ item.quantity }}</span>

                  <button pButton icon="pi pi-plus"
                          class="p-button-rounded p-button-sm"
                          (click)="increaseQuantity(item)"
                          [disabled]="isLoading">
                  </button>

                </div>
              </td>

              <td class="font-bold">
                {{ item.price * item.quantity | currency:'ILS':'symbol':'1.0-0' }}
              </td>

              <td>
                <button
                  pButton
                  icon="pi pi-trash"
                  class="p-button-rounded p-button-danger p-button-text"
                  (click)="deleteGift(item)"
                  [disabled]="isLoading">
                </button>
              </td>

            </tr>
          </ng-template>

          <ng-template pTemplate="footer">
            <tr>
              <td colspan="3" class="text-right font-bold">סה"כ:</td>
              <td colspan="2" class="font-bold">
                {{ (totalPrice$ | async) | currency:'ILS':'symbol':'1.0-0' }}
              </td>
            </tr>
          </ng-template>

        </p-table>

        <div class="flex justify-content-end mt-4">
          <button
            pButton
            label="בצע רכישה"
            icon="pi pi-check-circle"
            class="p-button-success"
            (click)="checkout()"
            [loading]="isLoading">
          </button>
        </div>
        <a routerLink="/" class="text-primary-600 font-bold no-underline hover:underline">חזור לרשימת המתנות</a>
      </div>

    </ng-container>

    <ng-template #emptyCart>
      <div class="text-center p-5">
        <i class="pi pi-shopping-cart" style="font-size:3rem;"></i>
        <h3>הסל ריק</h3>
      </div>
      <a routerLink="/" class="text-primary-600 font-bold no-underline hover:underline">חזור לרשימת המתנות</a>
    </ng-template>
    
  </p-card>
</div>
